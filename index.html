<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>AI Chat</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #f0f0f0;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .app {
    width: 100%;
    height: 100dvh;
    background: #fff;
    display: flex;
    flex-direction: column;
    max-width: 700px;
    margin: 0 auto;
  }

  /* Header */
  .header {
    background: #2c2c2c;
    color: #fff;
    padding: 14px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
  }

  .header-left { display: flex; align-items: center; gap: 10px; }
  .header-dot { width: 9px; height: 9px; background: #6bcb6b; border-radius: 50%; }
  .header-dot.off { background: #777; }
  .header h1 { font-size: 15px; font-weight: 600; }
  .header-model { font-size: 11px; color: #aaa; max-width: 140px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

  .clear-btn {
    background: none; border: none; color: #bbb;
    font-size: 12px; font-family: inherit; cursor: pointer; padding: 4px 8px;
  }
  .clear-btn:hover { color: #eee; }

  /* Setup */
  #setup-screen {
    flex: 1; display: flex; align-items: center;
    justify-content: center; padding: 24px 16px;
    background: #f7f7f7; overflow-y: auto;
  }

  .setup-box {
    background: #fff; border: 1px solid #ddd; border-radius: 10px;
    padding: 24px; width: 100%; max-width: 420px;
  }

  .setup-box h2 { font-size: 17px; color: #222; margin-bottom: 6px; font-weight: 600; }
  .setup-box p { font-size: 13px; color: #777; margin-bottom: 20px; line-height: 1.7; }
  .setup-box a { color: #444; }

  label {
    display: block; font-size: 11px; font-weight: 600; color: #555;
    margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px;
  }

  input[type="password"], select, textarea {
    width: 100%; border: 1px solid #ccc; border-radius: 6px;
    padding: 10px 12px; font-size: 14px; font-family: inherit; color: #222;
    background: #fafafa; outline: none; margin-bottom: 14px;
    transition: border-color 0.15s; -webkit-appearance: none;
  }

  input[type="password"]:focus, select:focus, textarea:focus {
    border-color: #555; background: #fff;
  }

  textarea { resize: vertical; }

  .btn {
    width: 100%; background: #2c2c2c; color: #fff; border: none;
    border-radius: 6px; padding: 13px; font-size: 15px; font-weight: 600;
    font-family: inherit; cursor: pointer; transition: background 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .btn:active { background: #111; }

  .error { color: #c00; font-size: 12px; margin-top: 8px; display: none; }

  /* Chat */
  #chat-screen { flex: 1; display: none; flex-direction: column; overflow: hidden; }

  #messages {
    flex: 1; overflow-y: auto; padding: 16px 14px;
    display: flex; flex-direction: column; gap: 10px;
    background: #f7f7f7;
    -webkit-overflow-scrolling: touch;
  }

  .msg { display: flex; gap: 8px; max-width: 90%; animation: fadein 0.2s ease; }

  @keyframes fadein {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .msg.user { align-self: flex-end; flex-direction: row-reverse; }
  .msg.ai { align-self: flex-start; }

  .avatar {
    width: 28px; height: 28px; border-radius: 50%; display: flex;
    align-items: center; justify-content: center; font-size: 11px;
    flex-shrink: 0; align-self: flex-end; color: #fff; font-weight: 700;
  }
  .avatar.ai-av { background: #555; }
  .avatar.user-av { background: #888; }

  .bubble {
    padding: 9px 13px; border-radius: 16px; font-size: 14px;
    line-height: 1.55; white-space: pre-wrap; word-break: break-word;
  }

  .msg.user .bubble {
    background: #2c2c2c; color: #fff; border-bottom-right-radius: 4px;
  }
  .msg.ai .bubble {
    background: #fff; color: #222; border: 1px solid #e0e0e0; border-bottom-left-radius: 4px;
  }

  .typing { display: flex; align-items: center; gap: 4px; padding: 3px 0; }
  .dot {
    width: 7px; height: 7px; background: #bbb; border-radius: 50%;
    animation: bounce 1.1s infinite;
  }
  .dot:nth-child(2) { animation-delay: 0.18s; }
  .dot:nth-child(3) { animation-delay: 0.36s; }

  @keyframes bounce {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-5px); }
  }

  /* Input */
  .input-area {
    border-top: 1px solid #ddd; padding: 10px 12px;
    background: #fff; display: flex; gap: 8px;
    align-items: flex-end; flex-shrink: 0;
    padding-bottom: max(10px, env(safe-area-inset-bottom));
  }

  #user-input {
    flex: 1; border: 1px solid #ccc; border-radius: 20px;
    padding: 9px 14px; font-size: 15px; font-family: inherit;
    outline: none; resize: none; max-height: 120px; line-height: 1.4;
    background: #fafafa; color: #222; transition: border-color 0.15s;
    margin-bottom: 0; -webkit-appearance: none;
  }
  #user-input:focus { border-color: #888; background: #fff; }
  #user-input::placeholder { color: #bbb; }

  #send-btn {
    width: 40px; height: 40px; background: #2c2c2c; border: none;
    border-radius: 50%; color: white; cursor: pointer; display: flex;
    align-items: center; justify-content: center; flex-shrink: 0;
    transition: background 0.15s; -webkit-tap-highlight-color: transparent;
  }
  #send-btn:active { background: #444; }
  #send-btn:disabled { background: #ccc; }

  .welcome { text-align: center; padding: 40px 16px; color: #999; }
  .welcome h3 { font-size: 15px; color: #555; margin-bottom: 6px; }
  .welcome p { font-size: 13px; line-height: 1.6; }

  .chips { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 16px; }

  .chip {
    background: #fff; border: 1px solid #ccc; border-radius: 999px;
    padding: 7px 14px; font-size: 13px; color: #444; cursor: pointer;
    font-family: inherit; -webkit-tap-highlight-color: transparent;
  }
  .chip:active { background: #f0f0f0; }
</style>
</head>
<body>
<div class="app">

  <div class="header">
    <div class="header-left">
      <div class="header-dot off" id="status-dot"></div>
      <h1>AI Chat</h1>
    </div>
    <div style="display:flex;align-items:center;gap:10px;">
      <span class="header-model" id="model-label">not connected</span>
      <button class="clear-btn" id="clear-btn" onclick="clearChat()" style="display:none">Clear</button>
    </div>
  </div>

  <!-- Setup -->
  <div id="setup-screen">
    <div class="setup-box">
      <h2>Connect to Groq AI</h2>
      <p>
        Enter your free Groq API key to start chatting.<br><br>
        To get a key: go to <a href="https://console.groq.com" target="_blank">console.groq.com</a>,
        sign up with Google or email (no credit card needed), tap
        <strong>API Keys</strong> and create one. It starts with <strong>gsk_</strong>
      </p>

      <label>API Key</label>
      <input type="password" id="api-key" placeholder="gsk_..." autocomplete="off" />

      <label>Model</label>
      <select id="model">
        <option value="llama-3.3-70b-versatile">Llama 3.3 70B — best quality</option>
        <option value="llama-3.1-8b-instant">Llama 3.1 8B — faster</option>
        <option value="gemma2-9b-it">Gemma 2 9B — Google's model</option>
        <option value="mixtral-8x7b-32768">Mixtral 8x7B — long chats</option>
      </select>

      <label>Personality</label>
      <textarea id="system-prompt" rows="2">You are a helpful, honest, and friendly AI assistant. Be clear and concise.</textarea>

      <button class="btn" onclick="connect()">Connect →</button>
      <div class="error" id="error">Please enter your API key first.</div>
    </div>
  </div>

  <!-- Chat -->
  <div id="chat-screen">
    <div id="messages">
      <div class="welcome" id="welcome">
        <h3>How can I help you?</h3>
        <p>Connected to Groq AI. Ask me anything.</p>
        <div class="chips">
          <button class="chip" onclick="useSuggestion(this)">Explain something simply</button>
          <button class="chip" onclick="useSuggestion(this)">Write a short story</button>
          <button class="chip" onclick="useSuggestion(this)">Help me write an email</button>
          <button class="chip" onclick="useSuggestion(this)">Give me a recipe idea</button>
        </div>
      </div>
    </div>

    <div class="input-area">
      <textarea id="user-input" placeholder="Type a message..." rows="1"
        oninput="grow(this)"></textarea>
      <button id="send-btn" onclick="send()">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"/>
          <polygon points="22 2 15 22 11 13 2 9 22 2"/>
        </svg>
      </button>
    </div>
  </div>

</div>

<script>
  let apiKey, model, sysPrompt, history = [], busy = false;

  function connect() {
    apiKey = document.getElementById('api-key').value.trim();
    if (!apiKey) { document.getElementById('error').style.display = 'block'; return; }
    model = document.getElementById('model').value;
    sysPrompt = document.getElementById('system-prompt').value.trim();

    // Save key locally so user doesn't have to re-enter
    try { localStorage.setItem('groq_key', apiKey); } catch(e) {}

    document.getElementById('setup-screen').style.display = 'none';
    document.getElementById('chat-screen').style.display = 'flex';
    document.getElementById('status-dot').classList.remove('off');
    document.getElementById('model-label').textContent = model;
    document.getElementById('clear-btn').style.display = 'inline';
    history = [];
  }

  // Auto-fill saved key
  try {
    const saved = localStorage.getItem('groq_key');
    if (saved) document.getElementById('api-key').value = saved;
  } catch(e) {}

  function grow(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 120) + 'px';
  }

  function useSuggestion(el) {
    document.getElementById('user-input').value = el.textContent;
    send();
  }

  async function send() {
    const input = document.getElementById('user-input');
    const text = input.value.trim();
    if (!text || busy) return;

    const welcome = document.getElementById('welcome');
    if (welcome) welcome.remove();

    input.value = '';
    input.style.height = 'auto';
    busy = true;
    document.getElementById('send-btn').disabled = true;

    addMsg('user', text);
    history.push({ role: 'user', content: text });

    const typingEl = addTyping();

    try {
      const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + apiKey
        },
        body: JSON.stringify({
          model: model,
          messages: [{ role: 'system', content: sysPrompt }, ...history]
        })
      });

      typingEl.remove();

      if (!res.ok) {
        const err = await res.json();
        addMsg('ai', '⚠️ Error: ' + (err?.error?.message || 'Something went wrong.'));
        history.pop();
      } else {
        const data = await res.json();
        const reply = data.choices[0].message.content;
        history.push({ role: 'assistant', content: reply });
        addMsg('ai', reply);
      }
    } catch (e) {
      typingEl.remove();
      addMsg('ai', '⚠️ Could not reach Groq. Check your internet connection and make sure your API key is correct.');
      history.pop();
    }

    busy = false;
    document.getElementById('send-btn').disabled = false;
  }

  function addMsg(role, text) {
    const wrap = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = 'msg ' + role;

    const av = document.createElement('div');
    av.className = 'avatar ' + (role === 'user' ? 'user-av' : 'ai-av');
    av.textContent = role === 'user' ? 'U' : 'AI';

    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.textContent = text;

    div.appendChild(av);
    div.appendChild(bubble);
    wrap.appendChild(div);
    wrap.scrollTop = wrap.scrollHeight;
  }

  function addTyping() {
    const wrap = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = 'msg ai';

    const av = document.createElement('div');
    av.className = 'avatar ai-av';
    av.textContent = 'AI';

    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.innerHTML = '<div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';

    div.appendChild(av);
    div.appendChild(bubble);
    wrap.appendChild(div);
    wrap.scrollTop = wrap.scrollHeight;
    return div;
  }

  function clearChat() {
    history = [];
    document.getElementById('messages').innerHTML = '';
  }
</script>
</body>
</html>
